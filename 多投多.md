# 多个无人机投放多个烟幕弹的数学模型

## 1. 符号与已知常量（统一）
- 参考坐标系：假目标在原点 $\mathbf{O}=(0,0,0)$，真目标圆心 $\mathbf{T}=(0,200,0)$。
- 导弹 M1：
  - 初始位置 $\mathbf{M}_0=(20000,0,2000)$；
  - 匀速 $v_m=300\ \mathrm{m/s}$；
  - 位置：$\mathbf{M}(t)=\mathbf{M}_0 + v_m\,t\,\mathbf{u}_m$, 其中 $\mathbf{u}_m=(\mathbf{O}-\mathbf{M}_0)/\|\mathbf{O}-\mathbf{M}_0\|$。
- 无人机 $i（i∈{1,2,3}）：$
  - 初始位置 $\mathbf{F}_i$（给定：$FY1,FY2,FY3$）；
  - 航向单位向量 $\mathbf{h}_i=(\cos\theta_i,\sin\theta_i,0)$；
  - 速度 $v_i\in[70,140]\ \mathrm{m/s}$；
  - 轨迹：$\mathbf{U}_i(t)=\mathbf{F}_i + v_i\,t\,\mathbf{h}_i$（从 $t=0$ 起以该航向恒速飞行）。
- 每架无人机投放 1 枚弹（编号与无人机同 i）：
  - 投放 $t_{r,i}\ge 0$；
  - 起爆时间 $t_{d,i}>0$；
  - 起爆时刻 $t_{e,i}=t_{r,i}+t_{d,i}$；
  - 释放点 $\mathbf{R}_i=\mathbf{U}_i(t_{r,i})$；
  - 起爆点（云团初始中心）：
    $\
    \mathbf{P}_i = \mathbf{R}_i + v_i\mathbf{h}_i\,t_{d,i} + (0,0,-\tfrac12 g t_{d,i}^2).
    $\
- 云团特性（题设）：
  - 半径 $R_c = 10\ \mathrm{m}$；
  - 下沉速度 $w=3\ \mathrm{m/s}$；
  - 有效持续时间 $T_c = 20\ \mathrm{s}$；
  - 云团中心：$\mathbf{C}_i(t)=\mathbf{P}_i + (0,0,-w(t-t_{e,i}))$，$t\in[t_{e,i},t_{e,i}+T_c]$。

## 2. 遮蔽判据（同问题三）
在任意时刻 $t$，令 $\mathbf{A}=\mathbf{M}(t)$，$\mathbf{B}=\mathbf{T}$，$\mathbf{C}=\mathbf{C}_i(t)$：
- 投影参数
  $$
  \alpha_i(t)=\frac{(\mathbf{C}-\mathbf{A})\cdot(\mathbf{B}-\mathbf{A})}{\|\mathbf{B}-\mathbf{A}\|^2}.
  $$
- 若 $0\le\alpha_i(t)\le1$ 且
  $$
  d_i(t)=\|\mathbf{C}- (\mathbf{A}+\alpha_i(t)(\mathbf{B}-\mathbf{A}))\|\le R_c,
  $$
则云团 $i$ 在时刻 $t$ 对导弹发生遮蔽。

定义指示函数
$$
\mathbb{I}_i(t)=
\begin{cases}
1 & \text{若 $i$ 在时刻 $t$ 遮蔽导弹}\\
0 & \text{否则}
\end{cases}
$$

## 3. 目标函数
- 并集遮蔽指示：
  $$
  \mathbb{I}_{\text{any}}(t) = \mathbf{1}\Big(\sum_{i=1}^3 \mathbb{I}_i(t) \ge 1\Big).
  $$
- 目标：最大化导弹到达时间区间 $[0,t_{\text{hit}}]$ 内的并集遮蔽时间
  $$
  J = \int_{0}^{t_{\text{hit}}} \mathbb{I}_{\text{any}}(t)\,dt.
  $$
  其中 $t_{\text{hit}} = \|\mathbf{O}-\mathbf{M}_0\| / v_m$。

## 4. 决策变量与约束
- 决策变量：
  $$
  \{v_i,\theta_i,t_{r,i},t_{d,i}\}_{i=1}^3.
  $$
- 约束：
  - $v_{\min}\le v_i\le v_{\max}$；
  - $t_{r,i}\ge 0$, $t_{d,i}>0$, $t_{e,i}\le t_{\text{hit}}$；
  - 起爆高度 $P_{i,z} = F_{i,z} - \tfrac12 g t_{d,i}^2 \ge 0$（或允许落地起爆另行处理）。
  - （题设对同机多弹间隔只在多弹情况给出，此处每机仅一弹故无需间隔约束。）

## 5. 优化问题（连续非线性形式）
$$
\begin{aligned}
\max_{\{v_i,\theta_i,t_{r,i},t_{d,i}\}} \quad & J = \int_{0}^{t_{\text{hit}}} \mathbf{1}\Big(\sum_{i=1}^3 \mathbb{I}_i(t)\ge1\Big)\, dt\\[4pt]
\text{s.t.}\quad & v_{\min}\le v_i\le v_{\max},\; t_{r,i}\ge0,\; t_{d,i}>0,\; t_{e,i}\le t_{\text{hit}},\\
& \mathbf{P}_i \text{ 按上式由 } v_i,\theta_i,t_{r,i},t_{d,i} \text{ 给出},\ \forall i.
\end{aligned}
$$

## 6. 离散化 (MILP/0-1) 近似建模（若要用整数优化器）
- 时间网格 $t_k=k\Delta t,\ k=0,\dots,K$。
- 二进制变量：
  - $x_{i,k}=1$ 若无人机 $i$ 的弹在格点 $t_k$ 起爆（每机最多一次： $\sum_k x_{i,k}\le1$）；
  - $y_k=1$ 若在 $t_k$ 有遮蔽（要最大化 $\sum_k y_k\Delta t$）。
- 预处理布尔常量 $b_{i,k',k}\in\{0,1\}$：若弹 $i$ 在 $t_{e}=t_{k'}$ 起爆，则在格点 $t_k$ 会遮蔽导弹（根据几何判据与云团下沉预先判定）。
- 关联约束：
  - $y_k \le \sum_{i}\sum_{k'} b_{i,k',k}\, x_{i,k'}$；
  - $\sum_{k} x_{i,k} \le 1,\ \forall i$。
- 若将 $v_i,\theta_i$ 离散化为轨迹集合，用额外二进制 $z_{i,r}$ 表示选轨迹，再把某一爆炸格 $k'$ 仅允许当所选轨迹可达时才允许 $x_{i,k'}=1$（通过预计算可到达性矩阵）。

目标（线性化）：
\[
\max \sum_{k} y_k \Delta t.
\]

## 7. 求解建议
- **候选事件法（推荐、工程实用）**：
  1. 对每架无人机独立做单弹可行事件搜索（参数化为 $(t_e,s)$ 或直接在时间/位置网格上枚举），记录所有满足无人机速度/高度/释放时刻可行性的事件（每事件包含 $t_{r,i},t_{d,i},v_i,\theta_i,\mathbf{P}_i$ 与该事件的单弹遮蔽区间）。
  2. 由于每架仅投 1 枚，最终选择为每架从其候选事件集合中各选一项（可并行搜索每架），计算三云团并集遮蔽时长，枚举或做三重组合搜索取最优（若每机候选数为 $N$，组合数为 $N^3$，一般可接受）。
  3. 对最优方案在邻域做局部细化（更小时间步长）以提升精度。
- **全局优化法**：把 12 个连续变量作为黑盒输入，用差分进化/PSO/GA 搜索，再局部精修（适合不离散速度、航向的情形）。
- **MILP 法**：如需严格最优或对二进制判定建模，按离散化方案建 MILP 并用 Gurobi/CPLEX 求解（但网格越细变量越多，求解时间成倍增加）。
- **并行化**：候选事件生成和单事件遮蔽时间评估可并行化以节省时间。

## 8. 输出
- 每架无人机的最优决策 $(v_i^\star,\theta_i^\star,t_{r,i}^\star,t_{d,i}^\star)$；
- 每次起爆点 $\mathbf{P}_i^\star$ 与起爆时刻 $t_{e,i}^\star$；
- 并集遮蔽时间区间集合与总时长 $J^\star$；
- 可视化：导弹轨迹、无人机轨迹、云团随时间位置与遮蔽时间条带图。
